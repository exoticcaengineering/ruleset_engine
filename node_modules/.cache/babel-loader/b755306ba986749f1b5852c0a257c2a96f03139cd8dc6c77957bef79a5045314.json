{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useState } from \"react\";\nimport { v4 as uuidv4 } from 'uuid';\nimport axios from \"axios\";\nconst options = {\n  withCredentials: true,\n  headers: {\n    cookie: \"G_ENABLED_IDPS=google; _hjid=b3f8f0d2-85da-46ff-b7e6-f680e09defb6; _hjSessionUser_2285668=eyJpZCI6IjkwZDQ2NzViLTU0MTktNWY4OS1iOWU0LWJmYWY2Y2RlOTFkYSIsImNyZWF0ZWQiOjE2NDA3NzQ5MDM2MzYsImV4aXN0aW5nIjp0cnVlfQ==; _ex_gtm_employee=true; adiV=10277383; _gcl_au=1.1.530920154.1640779457; _ga_P46KE5C14Q=GS1.1.1642409769.1.0.1642409769.60; _gaexp=GAX1.2.jhmS17wCR32I_Qy8avJWaQ.19050.0!SAbyFgODTkKIM7WO8QBCPg.19040.0; _hjSessionUser_1310244=eyJpZCI6ImU1MTFkYmU1LTUyNmYtNTA2YS04OTAxLWUyN2NjNGY3OGZmYSIsImNyZWF0ZWQiOjE2NDMyMTQ4OTMxODAsImV4aXN0aW5nIjp0cnVlfQ==; _hjSessionUser_922367=eyJpZCI6Ijk0ZjkwNzM4LTYyYzYtNTc4Yi05NTI5LWQyNjNjOGU5ZmJmYiIsImNyZWF0ZWQiOjE2NDM3MTc5MzIzNzgsImV4aXN0aW5nIjp0cnVlfQ==; _ga_FGF23X494Q=GS1.1.1643907702.1.1.1643908778.60; _gid=GA1.2.762033289.1645444098; _ga_487HNCPBES=GS1.1.1645542654.12.1.1645544317.52; _ga_307RR3NMV2=GS1.1.1645545946.47.1.1645547913.0; exoticca_usr_adm=706|82308753bd4d0aa5d359b4489cbadcc0; FPID=FPID2.2.PY3xUVV6Tvedt%2F82snKR1JAtcM%2FkSQgpYh%2F1xR0PLNo%3D.1645705336; _ga_ME77EE605V=GS1.1.1645708227.15.0.1645708227.60; FPLC=BkoO6iFPLl8CMAVepZC9zXb9acnjlW6eg6oRJpX5Ra2oc7fBZI5uoaecnYk6S0NQ%2F4NKk2LaAUwArgZcDnWk85SuVdG5qgPLkDEXr5vmh0Otks7BdqtBBMpL45cwhw%3D%3D; _ga=GA1.1.68919515.1645705336; _ga_8S10FQZ6KB=GS1.1.1645787183.19.0.1645787444.60; _ga_6W2KMNZ8Y1=GS1.1.1645708212.24.1.1645708227.45\"\n  }\n};\nconst useRules = (url, discountUuid, discountName, rulesetType) => {\n  _s();\n  const [existingRules, setRules] = useState([]);\n  const [rulesetUuid, setUuid] = useState(null);\n  const [isLoading, setLoading] = useState(true);\n  const [error, setError] = useState();\n  const uuidParam = rulesetType === \"discount_tool\" ? 'discountUuid' : 'landingGeneratorUuid';\n  const addRule = async newRule => {\n    const payload = {\n      [uuidParam]: discountUuid,\n      name: discountName.replace(/\\s/g, \"\"),\n      description: discountName,\n      rulesetType: rulesetType,\n      active: true,\n      startsOn: null,\n      endsOn: null,\n      rulesetField: newRule.name,\n      rulesetOperator: newRule.operator,\n      value: newRule.value\n    };\n    console.log(payload);\n    const res = await axios.post(`${url}/${rulesetUuid || uuidv4()}`, payload);\n    console.log(res);\n    setRules(prev => [...prev, newRule]);\n  };\n  useEffect(() => {\n    const fetchRuleset = async () => {\n      try {\n        const {\n          data\n        } = await axios.get(`${url}?${uuidParam}=${discountUuid}`, options);\n        setRules(data.current.schema);\n        console.log(\"data: \", data);\n        console.log(\"data.uuid: \", data.uuid);\n        setUuid(data.uuid);\n      } catch (error) {\n        setError(error);\n        setRules([]);\n      }\n      setLoading(false);\n    };\n    fetchRuleset();\n  }, [discountUuid, url, uuidParam]);\n  return {\n    existingRules,\n    setRules,\n    addRule,\n    loadingRules: isLoading,\n    errorRules: error\n  };\n};\n_s(useRules, \"W7n1gDIfjxlGq2jGnoaMGQ8I2Lg=\");\nexport default useRules;","map":{"version":3,"names":["useEffect","useState","v4","uuidv4","axios","options","withCredentials","headers","cookie","useRules","url","discountUuid","discountName","rulesetType","_s","existingRules","setRules","rulesetUuid","setUuid","isLoading","setLoading","error","setError","uuidParam","addRule","newRule","payload","name","replace","description","active","startsOn","endsOn","rulesetField","rulesetOperator","operator","value","console","log","res","post","prev","fetchRuleset","data","get","current","schema","uuid","loadingRules","errorRules"],"sources":["/Users/dave/Documents/Exoticca/ruleset_engine/src/library/hooks/useRules.tsx"],"sourcesContent":["import { useEffect, useState } from \"react\";\nimport { v4 as uuidv4 } from 'uuid';\nimport axios from \"axios\";\n\ntype CallError = {\n  message: string;\n  code: string;\n};\n\nconst options = {\n  withCredentials: true,\n  headers: {\n    cookie:\n      \"G_ENABLED_IDPS=google; _hjid=b3f8f0d2-85da-46ff-b7e6-f680e09defb6; _hjSessionUser_2285668=eyJpZCI6IjkwZDQ2NzViLTU0MTktNWY4OS1iOWU0LWJmYWY2Y2RlOTFkYSIsImNyZWF0ZWQiOjE2NDA3NzQ5MDM2MzYsImV4aXN0aW5nIjp0cnVlfQ==; _ex_gtm_employee=true; adiV=10277383; _gcl_au=1.1.530920154.1640779457; _ga_P46KE5C14Q=GS1.1.1642409769.1.0.1642409769.60; _gaexp=GAX1.2.jhmS17wCR32I_Qy8avJWaQ.19050.0!SAbyFgODTkKIM7WO8QBCPg.19040.0; _hjSessionUser_1310244=eyJpZCI6ImU1MTFkYmU1LTUyNmYtNTA2YS04OTAxLWUyN2NjNGY3OGZmYSIsImNyZWF0ZWQiOjE2NDMyMTQ4OTMxODAsImV4aXN0aW5nIjp0cnVlfQ==; _hjSessionUser_922367=eyJpZCI6Ijk0ZjkwNzM4LTYyYzYtNTc4Yi05NTI5LWQyNjNjOGU5ZmJmYiIsImNyZWF0ZWQiOjE2NDM3MTc5MzIzNzgsImV4aXN0aW5nIjp0cnVlfQ==; _ga_FGF23X494Q=GS1.1.1643907702.1.1.1643908778.60; _gid=GA1.2.762033289.1645444098; _ga_487HNCPBES=GS1.1.1645542654.12.1.1645544317.52; _ga_307RR3NMV2=GS1.1.1645545946.47.1.1645547913.0; exoticca_usr_adm=706|82308753bd4d0aa5d359b4489cbadcc0; FPID=FPID2.2.PY3xUVV6Tvedt%2F82snKR1JAtcM%2FkSQgpYh%2F1xR0PLNo%3D.1645705336; _ga_ME77EE605V=GS1.1.1645708227.15.0.1645708227.60; FPLC=BkoO6iFPLl8CMAVepZC9zXb9acnjlW6eg6oRJpX5Ra2oc7fBZI5uoaecnYk6S0NQ%2F4NKk2LaAUwArgZcDnWk85SuVdG5qgPLkDEXr5vmh0Otks7BdqtBBMpL45cwhw%3D%3D; _ga=GA1.1.68919515.1645705336; _ga_8S10FQZ6KB=GS1.1.1645787183.19.0.1645787444.60; _ga_6W2KMNZ8Y1=GS1.1.1645708212.24.1.1645708227.45\",\n  },\n};\n\nconst useRules = (\n  url: string,\n  discountUuid: string,\n  discountName: string,\n  rulesetType: RulesetType\n) => {\n  const [existingRules, setRules] = useState<RuleValues[]>([]);\n  const [rulesetUuid, setUuid] = useState<string | null>(null);\n  const [isLoading, setLoading] = useState<boolean>(true);\n  const [error, setError] = useState<CallError | undefined>();\n\n  const uuidParam = rulesetType === \"discount_tool\" ? 'discountUuid' : 'landingGeneratorUuid'\n\n  const addRule = async (newRule: RuleValues) => {\n    const payload = {\n      [uuidParam]: discountUuid,\n      name: discountName.replace(/\\s/g, \"\"),\n      description: discountName,\n      rulesetType: rulesetType,\n      active: true,\n      startsOn: null,\n      endsOn: null,\n      rulesetField: newRule.name,\n      rulesetOperator: newRule.operator,\n      value: newRule.value,\n    };\n    console.log(payload);\n    const res = await axios.post(`${url}/${rulesetUuid || uuidv4()}`, payload);\n    console.log(res);\n    setRules((prev) => [...prev, newRule]);\n  };\n\n  useEffect(() => {\n    const fetchRuleset = async () => {\n      try {\n        const { data } = await axios.get<{ current: any; uuid: string }>(\n          `${url}?${uuidParam}=${discountUuid}`,\n          options\n        );\n        setRules(data.current.schema);\n        console.log(\"data: \", data);\n        console.log(\"data.uuid: \", data.uuid);\n        setUuid(data.uuid);\n      } catch (error) {\n        setError(error as CallError);\n        setRules([]);\n      }\n\n      setLoading(false);\n    };\n    fetchRuleset();\n  }, [discountUuid, url, uuidParam]);\n\n  return {\n    existingRules,\n    setRules,\n    addRule,\n    loadingRules: isLoading,\n    errorRules: error,\n  };\n};\n\nexport default useRules;\n"],"mappings":";AAAA,SAASA,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AAC3C,SAASC,EAAE,IAAIC,MAAM,QAAQ,MAAM;AACnC,OAAOC,KAAK,MAAM,OAAO;AAOzB,MAAMC,OAAO,GAAG;EACdC,eAAe,EAAE,IAAI;EACrBC,OAAO,EAAE;IACPC,MAAM,EACJ;EACJ;AACF,CAAC;AAED,MAAMC,QAAQ,GAAGA,CACfC,GAAW,EACXC,YAAoB,EACpBC,YAAoB,EACpBC,WAAwB,KACrB;EAAAC,EAAA;EACH,MAAM,CAACC,aAAa,EAAEC,QAAQ,CAAC,GAAGf,QAAQ,CAAe,EAAE,CAAC;EAC5D,MAAM,CAACgB,WAAW,EAAEC,OAAO,CAAC,GAAGjB,QAAQ,CAAgB,IAAI,CAAC;EAC5D,MAAM,CAACkB,SAAS,EAAEC,UAAU,CAAC,GAAGnB,QAAQ,CAAU,IAAI,CAAC;EACvD,MAAM,CAACoB,KAAK,EAAEC,QAAQ,CAAC,GAAGrB,QAAQ,EAAyB;EAE3D,MAAMsB,SAAS,GAAGV,WAAW,KAAK,eAAe,GAAG,cAAc,GAAG,sBAAsB;EAE3F,MAAMW,OAAO,GAAG,MAAOC,OAAmB,IAAK;IAC7C,MAAMC,OAAO,GAAG;MACd,CAACH,SAAS,GAAGZ,YAAY;MACzBgB,IAAI,EAAEf,YAAY,CAACgB,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC;MACrCC,WAAW,EAAEjB,YAAY;MACzBC,WAAW,EAAEA,WAAW;MACxBiB,MAAM,EAAE,IAAI;MACZC,QAAQ,EAAE,IAAI;MACdC,MAAM,EAAE,IAAI;MACZC,YAAY,EAAER,OAAO,CAACE,IAAI;MAC1BO,eAAe,EAAET,OAAO,CAACU,QAAQ;MACjCC,KAAK,EAAEX,OAAO,CAACW;IACjB,CAAC;IACDC,OAAO,CAACC,GAAG,CAACZ,OAAO,CAAC;IACpB,MAAMa,GAAG,GAAG,MAAMnC,KAAK,CAACoC,IAAI,CAAE,GAAE9B,GAAI,IAAGO,WAAW,IAAId,MAAM,EAAG,EAAC,EAAEuB,OAAO,CAAC;IAC1EW,OAAO,CAACC,GAAG,CAACC,GAAG,CAAC;IAChBvB,QAAQ,CAAEyB,IAAI,IAAK,CAAC,GAAGA,IAAI,EAAEhB,OAAO,CAAC,CAAC;EACxC,CAAC;EAEDzB,SAAS,CAAC,MAAM;IACd,MAAM0C,YAAY,GAAG,MAAAA,CAAA,KAAY;MAC/B,IAAI;QACF,MAAM;UAAEC;QAAK,CAAC,GAAG,MAAMvC,KAAK,CAACwC,GAAG,CAC7B,GAAElC,GAAI,IAAGa,SAAU,IAAGZ,YAAa,EAAC,EACrCN,OAAO,CACR;QACDW,QAAQ,CAAC2B,IAAI,CAACE,OAAO,CAACC,MAAM,CAAC;QAC7BT,OAAO,CAACC,GAAG,CAAC,QAAQ,EAAEK,IAAI,CAAC;QAC3BN,OAAO,CAACC,GAAG,CAAC,aAAa,EAAEK,IAAI,CAACI,IAAI,CAAC;QACrC7B,OAAO,CAACyB,IAAI,CAACI,IAAI,CAAC;MACpB,CAAC,CAAC,OAAO1B,KAAK,EAAE;QACdC,QAAQ,CAACD,KAAK,CAAc;QAC5BL,QAAQ,CAAC,EAAE,CAAC;MACd;MAEAI,UAAU,CAAC,KAAK,CAAC;IACnB,CAAC;IACDsB,YAAY,EAAE;EAChB,CAAC,EAAE,CAAC/B,YAAY,EAAED,GAAG,EAAEa,SAAS,CAAC,CAAC;EAElC,OAAO;IACLR,aAAa;IACbC,QAAQ;IACRQ,OAAO;IACPwB,YAAY,EAAE7B,SAAS;IACvB8B,UAAU,EAAE5B;EACd,CAAC;AACH,CAAC;AAACP,EAAA,CA5DIL,QAAQ;AA8Dd,eAAeA,QAAQ"},"metadata":{},"sourceType":"module","externalDependencies":[]}